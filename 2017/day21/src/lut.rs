/// This value is used in look-up tables to mark empty cells
pub const UM: u16 = u16::MAX;

/// Maps all possible 2x2 patterns to all their transformations
///
/// This table was generated using the [build_lut] function and copy&pasted here
pub static LUT_2: [[u16; 4]; 16] = [
    [0, UM, UM, UM],
    [1, 2, 4, 8],
    [1, 2, 4, 8],
    [3, 5, 10, 12],
    [1, 2, 4, 8],
    [3, 5, 10, 12],
    [6, 9, UM, UM],
    [7, 11, 13, 14],
    [1, 2, 4, 8],
    [6, 9, UM, UM],
    [3, 5, 10, 12],
    [7, 11, 13, 14],
    [3, 5, 10, 12],
    [7, 11, 13, 14],
    [7, 11, 13, 14],
    [15, UM, UM, UM],
];

/// Maps all possible 3x3 patterns to all their transformations
///
/// This table was generated using the [build_lut] function and copy&pasted here
pub static LUT_3: [[u16; 8]; 512] = [
    [0, UM, UM, UM, UM, UM, UM, UM],
    [1, 4, 64, 256, UM, UM, UM, UM],
    [2, 8, 32, 128, UM, UM, UM, UM],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [1, 4, 64, 256, UM, UM, UM, UM],
    [5, 65, 260, 320, UM, UM, UM, UM],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [7, 73, 292, 448, UM, UM, UM, UM],
    [2, 8, 32, 128, UM, UM, UM, UM],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [10, 34, 136, 160, UM, UM, UM, UM],
    [11, 38, 200, 416, UM, UM, UM, UM],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [16, UM, UM, UM, UM, UM, UM, UM],
    [17, 20, 80, 272, UM, UM, UM, UM],
    [18, 24, 48, 144, UM, UM, UM, UM],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [17, 20, 80, 272, UM, UM, UM, UM],
    [21, 81, 276, 336, UM, UM, UM, UM],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [23, 89, 308, 464, UM, UM, UM, UM],
    [18, 24, 48, 144, UM, UM, UM, UM],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [26, 50, 152, 176, UM, UM, UM, UM],
    [27, 54, 216, 432, UM, UM, UM, UM],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [2, 8, 32, 128, UM, UM, UM, UM],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [10, 34, 136, 160, UM, UM, UM, UM],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [11, 38, 200, 416, UM, UM, UM, UM],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [40, 130, UM, UM, UM, UM, UM, UM],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [42, 138, 162, 168, UM, UM, UM, UM],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [45, 195, 360, 390, UM, UM, UM, UM],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [47, 203, 422, 488, UM, UM, UM, UM],
    [18, 24, 48, 144, UM, UM, UM, UM],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [26, 50, 152, 176, UM, UM, UM, UM],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [27, 54, 216, 432, UM, UM, UM, UM],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [56, 146, UM, UM, UM, UM, UM, UM],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [58, 154, 178, 184, UM, UM, UM, UM],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [61, 211, 376, 406, UM, UM, UM, UM],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [63, 219, 438, 504, UM, UM, UM, UM],
    [1, 4, 64, 256, UM, UM, UM, UM],
    [5, 65, 260, 320, UM, UM, UM, UM],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [68, 257, UM, UM, UM, UM, UM, UM],
    [69, 261, 321, 324, UM, UM, UM, UM],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [7, 73, 292, 448, UM, UM, UM, UM],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [78, 228, 291, 393, UM, UM, UM, UM],
    [79, 295, 457, 484, UM, UM, UM, UM],
    [17, 20, 80, 272, UM, UM, UM, UM],
    [21, 81, 276, 336, UM, UM, UM, UM],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [84, 273, UM, UM, UM, UM, UM, UM],
    [85, 277, 337, 340, UM, UM, UM, UM],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [23, 89, 308, 464, UM, UM, UM, UM],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [94, 244, 307, 409, UM, UM, UM, UM],
    [95, 311, 473, 500, UM, UM, UM, UM],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [97, 133, 268, 322, UM, UM, UM, UM],
    [98, 140, 161, 266, UM, UM, UM, UM],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [102, 204, 267, 417, UM, UM, UM, UM],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [105, 135, 300, 450, UM, UM, UM, UM],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [108, 198, 297, 387, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [113, 149, 284, 338, UM, UM, UM, UM],
    [114, 156, 177, 282, UM, UM, UM, UM],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [118, 220, 283, 433, UM, UM, UM, UM],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [121, 151, 316, 466, UM, UM, UM, UM],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [124, 214, 313, 403, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [2, 8, 32, 128, UM, UM, UM, UM],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [40, 130, UM, UM, UM, UM, UM, UM],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [97, 133, 268, 322, UM, UM, UM, UM],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [105, 135, 300, 450, UM, UM, UM, UM],
    [10, 34, 136, 160, UM, UM, UM, UM],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [42, 138, 162, 168, UM, UM, UM, UM],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [98, 140, 161, 266, UM, UM, UM, UM],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [18, 24, 48, 144, UM, UM, UM, UM],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [56, 146, UM, UM, UM, UM, UM, UM],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [113, 149, 284, 338, UM, UM, UM, UM],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [121, 151, 316, 466, UM, UM, UM, UM],
    [26, 50, 152, 176, UM, UM, UM, UM],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [58, 154, 178, 184, UM, UM, UM, UM],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [114, 156, 177, 282, UM, UM, UM, UM],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [10, 34, 136, 160, UM, UM, UM, UM],
    [98, 140, 161, 266, UM, UM, UM, UM],
    [42, 138, 162, 168, UM, UM, UM, UM],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [42, 138, 162, 168, UM, UM, UM, UM],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [170, UM, UM, UM, UM, UM, UM, UM],
    [171, 174, 234, 426, UM, UM, UM, UM],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [173, 227, 362, 398, UM, UM, UM, UM],
    [171, 174, 234, 426, UM, UM, UM, UM],
    [175, 235, 430, 490, UM, UM, UM, UM],
    [26, 50, 152, 176, UM, UM, UM, UM],
    [114, 156, 177, 282, UM, UM, UM, UM],
    [58, 154, 178, 184, UM, UM, UM, UM],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [58, 154, 178, 184, UM, UM, UM, UM],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [186, UM, UM, UM, UM, UM, UM, UM],
    [187, 190, 250, 442, UM, UM, UM, UM],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [189, 243, 378, 414, UM, UM, UM, UM],
    [187, 190, 250, 442, UM, UM, UM, UM],
    [191, 251, 446, 506, UM, UM, UM, UM],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [45, 195, 360, 390, UM, UM, UM, UM],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [108, 198, 297, 387, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [11, 38, 200, 416, UM, UM, UM, UM],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [47, 203, 422, 488, UM, UM, UM, UM],
    [102, 204, 267, 417, UM, UM, UM, UM],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [61, 211, 376, 406, UM, UM, UM, UM],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [124, 214, 313, 403, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [27, 54, 216, 432, UM, UM, UM, UM],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [63, 219, 438, 504, UM, UM, UM, UM],
    [118, 220, 283, 433, UM, UM, UM, UM],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [173, 227, 362, 398, UM, UM, UM, UM],
    [78, 228, 291, 393, UM, UM, UM, UM],
    [229, 334, 355, 397, UM, UM, UM, UM],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [171, 174, 234, 426, UM, UM, UM, UM],
    [175, 235, 430, 490, UM, UM, UM, UM],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [238, 427, UM, UM, UM, UM, UM, UM],
    [239, 431, 491, 494, UM, UM, UM, UM],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [189, 243, 378, 414, UM, UM, UM, UM],
    [94, 244, 307, 409, UM, UM, UM, UM],
    [245, 350, 371, 413, UM, UM, UM, UM],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [187, 190, 250, 442, UM, UM, UM, UM],
    [191, 251, 446, 506, UM, UM, UM, UM],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [254, 443, UM, UM, UM, UM, UM, UM],
    [255, 447, 507, 510, UM, UM, UM, UM],
    [1, 4, 64, 256, UM, UM, UM, UM],
    [68, 257, UM, UM, UM, UM, UM, UM],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [5, 65, 260, 320, UM, UM, UM, UM],
    [69, 261, 321, 324, UM, UM, UM, UM],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [12, 33, 66, 96, 129, 132, 258, 264],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [98, 140, 161, 266, UM, UM, UM, UM],
    [102, 204, 267, 417, UM, UM, UM, UM],
    [97, 133, 268, 322, UM, UM, UM, UM],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [17, 20, 80, 272, UM, UM, UM, UM],
    [84, 273, UM, UM, UM, UM, UM, UM],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [21, 81, 276, 336, UM, UM, UM, UM],
    [85, 277, 337, 340, UM, UM, UM, UM],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [28, 49, 82, 112, 145, 148, 274, 280],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [114, 156, 177, 282, UM, UM, UM, UM],
    [118, 220, 283, 433, UM, UM, UM, UM],
    [113, 149, 284, 338, UM, UM, UM, UM],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [78, 228, 291, 393, UM, UM, UM, UM],
    [7, 73, 292, 448, UM, UM, UM, UM],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [79, 295, 457, 484, UM, UM, UM, UM],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [108, 198, 297, 387, UM, UM, UM, UM],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [105, 135, 300, 450, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [94, 244, 307, 409, UM, UM, UM, UM],
    [23, 89, 308, 464, UM, UM, UM, UM],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [95, 311, 473, 500, UM, UM, UM, UM],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [124, 214, 313, 403, UM, UM, UM, UM],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [121, 151, 316, 466, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [5, 65, 260, 320, UM, UM, UM, UM],
    [69, 261, 321, 324, UM, UM, UM, UM],
    [97, 133, 268, 322, UM, UM, UM, UM],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [69, 261, 321, 324, UM, UM, UM, UM],
    [325, UM, UM, UM, UM, UM, UM, UM],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [327, 333, 357, 453, UM, UM, UM, UM],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [327, 333, 357, 453, UM, UM, UM, UM],
    [229, 334, 355, 397, UM, UM, UM, UM],
    [335, 359, 461, 485, UM, UM, UM, UM],
    [21, 81, 276, 336, UM, UM, UM, UM],
    [85, 277, 337, 340, UM, UM, UM, UM],
    [113, 149, 284, 338, UM, UM, UM, UM],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [85, 277, 337, 340, UM, UM, UM, UM],
    [341, UM, UM, UM, UM, UM, UM, UM],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [343, 349, 373, 469, UM, UM, UM, UM],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [343, 349, 373, 469, UM, UM, UM, UM],
    [245, 350, 371, 413, UM, UM, UM, UM],
    [351, 375, 477, 501, UM, UM, UM, UM],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [229, 334, 355, 397, UM, UM, UM, UM],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [327, 333, 357, 453, UM, UM, UM, UM],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [335, 359, 461, 485, UM, UM, UM, UM],
    [45, 195, 360, 390, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [173, 227, 362, 398, UM, UM, UM, UM],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [365, 455, UM, UM, UM, UM, UM, UM],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [367, 463, 487, 493, UM, UM, UM, UM],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [245, 350, 371, 413, UM, UM, UM, UM],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [343, 349, 373, 469, UM, UM, UM, UM],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [351, 375, 477, 501, UM, UM, UM, UM],
    [61, 211, 376, 406, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [189, 243, 378, 414, UM, UM, UM, UM],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [381, 471, UM, UM, UM, UM, UM, UM],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [383, 479, 503, 509, UM, UM, UM, UM],
    [3, 6, 9, 36, 72, 192, 288, 384],
    [70, 76, 100, 196, 259, 265, 289, 385],
    [41, 44, 104, 131, 134, 194, 296, 386],
    [108, 198, 297, 387, UM, UM, UM, UM],
    [13, 37, 67, 193, 262, 328, 352, 388],
    [101, 197, 269, 323, 326, 332, 353, 389],
    [45, 195, 360, 390, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [14, 35, 74, 137, 164, 224, 290, 392],
    [78, 228, 291, 393, UM, UM, UM, UM],
    [106, 142, 163, 169, 172, 226, 298, 394],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [99, 141, 165, 225, 270, 330, 354, 396],
    [229, 334, 355, 397, UM, UM, UM, UM],
    [173, 227, 362, 398, UM, UM, UM, UM],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [19, 22, 25, 52, 88, 208, 304, 400],
    [86, 92, 116, 212, 275, 281, 305, 401],
    [57, 60, 120, 147, 150, 210, 312, 402],
    [124, 214, 313, 403, UM, UM, UM, UM],
    [29, 53, 83, 209, 278, 344, 368, 404],
    [117, 213, 285, 339, 342, 348, 369, 405],
    [61, 211, 376, 406, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [30, 51, 90, 153, 180, 240, 306, 408],
    [94, 244, 307, 409, UM, UM, UM, UM],
    [122, 158, 179, 185, 188, 242, 314, 410],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [115, 157, 181, 241, 286, 346, 370, 412],
    [245, 350, 371, 413, UM, UM, UM, UM],
    [189, 243, 378, 414, UM, UM, UM, UM],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [11, 38, 200, 416, UM, UM, UM, UM],
    [102, 204, 267, 417, UM, UM, UM, UM],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [47, 203, 422, 488, UM, UM, UM, UM],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [43, 46, 139, 166, 202, 232, 418, 424],
    [110, 206, 230, 236, 299, 395, 419, 425],
    [171, 174, 234, 426, UM, UM, UM, UM],
    [238, 427, UM, UM, UM, UM, UM, UM],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [175, 235, 430, 490, UM, UM, UM, UM],
    [239, 431, 491, 494, UM, UM, UM, UM],
    [27, 54, 216, 432, UM, UM, UM, UM],
    [118, 220, 283, 433, UM, UM, UM, UM],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [63, 219, 438, 504, UM, UM, UM, UM],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [59, 62, 155, 182, 218, 248, 434, 440],
    [126, 222, 246, 252, 315, 411, 435, 441],
    [187, 190, 250, 442, UM, UM, UM, UM],
    [254, 443, UM, UM, UM, UM, UM, UM],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [191, 251, 446, 506, UM, UM, UM, UM],
    [255, 447, 507, 510, UM, UM, UM, UM],
    [7, 73, 292, 448, UM, UM, UM, UM],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [105, 135, 300, 450, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [71, 77, 263, 293, 329, 356, 449, 452],
    [327, 333, 357, 453, UM, UM, UM, UM],
    [109, 199, 301, 361, 364, 391, 451, 454],
    [365, 455, UM, UM, UM, UM, UM, UM],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [79, 295, 457, 484, UM, UM, UM, UM],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [335, 359, 461, 485, UM, UM, UM, UM],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [367, 463, 487, 493, UM, UM, UM, UM],
    [23, 89, 308, 464, UM, UM, UM, UM],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [121, 151, 316, 466, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [87, 93, 279, 309, 345, 372, 465, 468],
    [343, 349, 373, 469, UM, UM, UM, UM],
    [125, 215, 317, 377, 380, 407, 467, 470],
    [381, 471, UM, UM, UM, UM, UM, UM],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [95, 311, 473, 500, UM, UM, UM, UM],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [351, 375, 477, 501, UM, UM, UM, UM],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [383, 479, 503, 509, UM, UM, UM, UM],
    [15, 39, 75, 201, 294, 420, 456, 480],
    [103, 205, 271, 331, 358, 421, 460, 481],
    [107, 143, 167, 233, 302, 428, 458, 482],
    [231, 237, 363, 366, 399, 429, 462, 483],
    [79, 295, 457, 484, UM, UM, UM, UM],
    [335, 359, 461, 485, UM, UM, UM, UM],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [367, 463, 487, 493, UM, UM, UM, UM],
    [47, 203, 422, 488, UM, UM, UM, UM],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [175, 235, 430, 490, UM, UM, UM, UM],
    [239, 431, 491, 494, UM, UM, UM, UM],
    [111, 207, 303, 423, 459, 486, 489, 492],
    [367, 463, 487, 493, UM, UM, UM, UM],
    [239, 431, 491, 494, UM, UM, UM, UM],
    [495, UM, UM, UM, UM, UM, UM, UM],
    [31, 55, 91, 217, 310, 436, 472, 496],
    [119, 221, 287, 347, 374, 437, 476, 497],
    [123, 159, 183, 249, 318, 444, 474, 498],
    [247, 253, 379, 382, 415, 445, 478, 499],
    [95, 311, 473, 500, UM, UM, UM, UM],
    [351, 375, 477, 501, UM, UM, UM, UM],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [383, 479, 503, 509, UM, UM, UM, UM],
    [63, 219, 438, 504, UM, UM, UM, UM],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [191, 251, 446, 506, UM, UM, UM, UM],
    [255, 447, 507, 510, UM, UM, UM, UM],
    [127, 223, 319, 439, 475, 502, 505, 508],
    [383, 479, 503, 509, UM, UM, UM, UM],
    [255, 447, 507, 510, UM, UM, UM, UM],
    [511, UM, UM, UM, UM, UM, UM, UM],
];

/// Flip horizontally
fn flip(pattern: u32, s: usize) -> u32 {
    // see https://graphics.stanford.edu/~seander/bithacks.html#SwappingBitsXOR
    let j = s * s - s;
    let x = (pattern ^ (pattern >> j)) & ((1 << s) - 1);
    pattern ^ (x | (x << j))
}

/// Rotate counterclockwise
fn rotate(pattern: u32, s: usize) -> u32 {
    let mut result = 0;
    for y in 0..s {
        for x in 0..s {
            if pattern & (1 << (y * s + x)) > 0 {
                result |= 1 << ((s - x - 1) * s + y);
            }
        }
    }
    result
}

/// Print a bitmask of a `pattern` of size `s` in a human-readable form to the
/// console
#[allow(unused)]
pub fn print_pattern(pattern: u32, s: usize) {
    for y in 0..s {
        for x in 0..s {
            if pattern & (1 << (y * s + x)) > 0 {
                print!("#");
            } else {
                print!(".");
            }
        }
        println!();
    }
    println!();
}

/// Build a look-up table mapping all possible patterns of size `s` to all their
/// transformations (rotated and flipped patterns). Print the result to the
/// console.
#[allow(unused)]
pub fn build_lut(s: usize) {
    let mut sets = Vec::new();
    let mut max_size = 0;
    for pattern in 0..1 << (s * s) {
        let rotated1 = rotate(pattern, s);
        let rotated2 = rotate(rotated1, s);
        let rotated3 = rotate(rotated2, s);

        let mut set = Vec::new();
        for g in [pattern, rotated1, rotated2, rotated3] {
            let f = flip(g, s);
            set.push(g);
            set.push(f);
        }
        set.sort_unstable();
        set.dedup();

        max_size = max_size.max(set.len());
        sets.push(set);
    }

    print!(
        "pub static LUT_{s}: [[u16; {max_size}]; {}] = [",
        1 << (s * s)
    );
    for set in sets {
        let sl = set.len();
        let mut ss = set.into_iter().map(|g| g.to_string()).collect::<Vec<_>>();
        if sl < max_size {
            ss.resize(max_size, "UM".to_string());
        }
        print!("[{}],", ss.join(", "));
    }
    println!("];");
}
